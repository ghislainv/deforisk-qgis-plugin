<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-03-10 Sun 16:14 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>forestatrisk QGIS plugin üì¶üêçüåé</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">forestatrisk QGIS plugin üì¶üêçüåé</h1>
</header><p>
<a href="https://www.gnu.org/licenses/gpl-3.0.html"><img src="https://img.shields.io/badge/licence-GPLv3-8f10cb.svg" alt="licence-GPLv3-8f10cb.svg" class="org-svg"></a>
<a href="https://github.com/ghislainv/forestatrisk-qgis-plugin"><img src="https://img.shields.io/badge/GitHub-repo-green.svg" alt="GitHub-repo-green.svg" class="org-svg"></a>
<a href="https://ecology.ghislainv.fr/forestatrisk-qgis-plugin"><img src="https://img.shields.io/badge/web-FAR_QGIS_plugin-blue.svg" alt="web-FAR_QGIS_plugin-blue.svg" class="org-svg"></a>
<a href="https://ecology.ghislainv.fr/forestatrisk"><img src="https://img.shields.io/badge/python-forestatrisk-306998?logo=python&amp;logoColor=ffd43b&amp;color=306998.svg" alt="python-forestatrisk-306998?logo=python&amp;logoColor=ffd43b&amp;color=306998.svg" class="org-svg"></a>
</p>

<div id="outline-container-org3c9a795" class="outline-2">
<h2 id="org3c9a795">Functionalities</h2>
<div class="outline-text-2" id="text-org3c9a795">
<p>
The plugin can be used to map the deforestation risk for a country or area of interest. Four models can be used to derive the risk maps: iCAR, GLM, Random Forest, and Moving Window models. All models are calibrated using past deforestation observations for a given period of time between 2000 and 2022. Forest cover change maps are provided by the user or derived from two global tree/forest cover change products: <a href="https://earthenginepartners.appspot.com/science-2013-global-forest">Global Forest Change</a> and <a href="https://forobs.jrc.ec.europa.eu/TMF">Tropical Moist Forests</a>.
</p>

<p>
Deforestation risk maps obtained using this plugin can be used to estimate emission reduction impact of forest conservation projects within the <a href="https://verra.org/programs/jurisdictional-nested-redd-framework/">VCS Jurisdictional and Nested REDD+ Framework</a>.
</p>
</div>
</div>

<div id="outline-container-org98f6194" class="outline-2">
<h2 id="org98f6194">Installation</h2>
<div class="outline-text-2" id="text-org98f6194">
</div>
<div id="outline-container-org9b356af" class="outline-3">
<h3 id="org9b356af">System dependencies</h3>
<div class="outline-text-3" id="text-org9b356af">
<p>
<a href="https://www.qgis.org/en/site/">QGIS</a> and <a href="https://gdal.org/index.html">GDAL</a> must be installed on your system. The <code>forestatrisk</code> Python package must also be installed on your system before using the QGIS plugin.
</p>
</div>

<div id="outline-container-orgd2f222d" class="outline-4">
<h4 id="orgd2f222d">Windows</h4>
<div class="outline-text-4" id="text-orgd2f222d">
</div>
<ul class="org-ul">
<li><a id="org0186c3d"></a>Install QGIS and GDAL on Windows<br>
<div class="outline-text-5" id="text-org0186c3d">
<p>
To install QGIS and GDAL on Windows, use the <a href="https://trac.osgeo.org/osgeo4w/">OSGeo4W</a> network installer. OSGeo4W is a binary distribution of a broad set of open source geospatial software for Windows environments (Windows 11 down to 7). Select <i>Express Install</i> and install both QGIS and GDAL. Several Gb of space will be needed on disk to install these programs. This will also install <i>OSGeo4W Shell</i> to execute command lines.
</p>
</div>
</li>

<li><a id="orgc9e5183"></a>Install the <code>forestatrisk</code> Python package on Windows<br>
<div class="outline-text-5" id="text-orgc9e5183">
<p>
To install the <code>forestatrisk</code> Python package, open OSGeo4W Shell, upgrade <code>pip</code> and <code>setuptools</code>, and install <code>forestatrisk</code> with <code>pip</code>.
</p>

<div class="org-src-container">
<pre class="src src-shell">python3.exe -m pip install --upgrade pip setuptools
python3.exe -m pip install forestatrisk
</pre>
</div>

<p>
Note: In case of problems, you can check the version of Python used by OSGeo4W using <i>OSGeo Shell</i> and that the package wheels for <code>forestatrisk</code> are available on <a href="https://pypi.org/project/forestatrisk/#files">PyPI</a> for your Windows and Python versions. Currently, PyPI provides wheels for Python 3.9 to 3.11 for Windows, Linux, and macOS 64-bit systems.
</p>

<div class="org-src-container">
<pre class="src src-shell">python3.exe --version
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org00c7a95" class="outline-4">
<h4 id="org00c7a95">Unix-like systems (Linux and macOS)</h4>
<div class="outline-text-4" id="text-org00c7a95">
</div>
<ul class="org-ul">
<li><a id="orge48b3db"></a>Install QGIS and GDAL on Unix-like systems<br>
<div class="outline-text-5" id="text-orge48b3db">
<p>
Install QGIS and GDAL on your system, for example using <code>apt-get</code> for Debian/Ubuntu Linux distributions.
</p>

<div class="org-src-container">
<pre class="src src-shell">sudo apt-get update
sudo apt-get install qgis gdal-bin libgdal-dev
</pre>
</div>

<p>
After installing GDAL, you can test the installation by running <code>gdalinfo --version</code> in the command prompt or terminal, which should display the installed GDAL version.
</p>
</div>
</li>

<li><a id="orgfd3d643"></a>Install the <code>forestatrisk</code> Python package on Unix-like systems<br>
<div class="outline-text-5" id="text-orgfd3d643">
<p>
On recent systems, you cannot use pip to install Python packages system-wide. As a consequence, we need to create a virtual environment and install the <code>forestatrisk</code> package in it. Make sure to also install the appropriate GDAL bindings using <code>gdal==$(gdal-config --version)</code>. Once the package and its dependencies have been installed, you can deactivate the virtual environment.
</p>

<div class="org-src-container">
<pre class="src src-shell">python3 -m venv /path/to/venv
<span class="org-builtin">source</span>  /path/to/venv/bin/activate
python3 -m pip install forestatrisk <span class="org-variable-name">gdal</span>==$(gdal-config --version)
deactivate
</pre>
</div>

<p>
Then, in the <code>setup.py</code> <a href="https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/intro.html#running-python-code-when-qgis-starts">Python file</a>, add the following two lines, adapting the path to your specific case (check the Python version). These two lines will be executed when QGIS starts and will add the path to the packages installed in the virtual environment to <code>sys.path</code>.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> sys
sys.path.append(<span class="org-string">"/path/to/venv/lib/python3.11/site-packages/"</span>)
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org6c97625" class="outline-3">
<h3 id="org6c97625">Installing the <code>forestatrisk</code> plugin in QGIS</h3>
<div class="outline-text-3" id="text-org6c97625">
<ul class="org-ul">
<li>Download the <code>forestatrisk</code> <a href="https://github.com/ghislainv/forestatrisk-qgis-plugin/archive/refs/heads/main.zip">zip file</a> from GitHub.</li>
<li>Open QGIS.</li>
<li>In QGIS menu bar, go to <code>Extensions/Install extensions/Install from ZIP</code>.</li>
<li>Select the zip file that has been downloaded.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org6da1ca0" class="outline-2">
<h2 id="org6da1ca0">Basic usage</h2>
<div class="outline-text-2" id="text-org6da1ca0">
</div>
<div id="outline-container-orgd821560" class="outline-3">
<h3 id="orgd821560">Plugin interface</h3>
<div class="outline-text-3" id="text-orgd821560">

<figure id="org96516bc">
<img src="https://ecology.ghislainv.fr/forestatrisk-qgis-plugin/images/interface_plugin.png" alt="interface_plugin.png">

</figure>

<p>
The plugin interface shows three tabs: <code>Get variables</code>, <code>Models FAR</code>, and <code>Model MV</code>. The <code>Get variables</code> tab includes two boxes: <code>Download and compute variables</code> and <code>Sample observations</code>. The items of each tab or box are detailed below. They usually correspond to function parameters from the <code>forestatrisk</code> Python package. 
</p>
</div>
</div>

<div id="outline-container-org9374dac" class="outline-3">
<h3 id="org9374dac">Download and compute variables</h3>
<div class="outline-text-3" id="text-org9374dac">
<p>
This box is for collecting the information needed to download the data and compute the variables that will be used to spatially model the deforestation risk for a given country.
</p>

<ul class="org-ul">
<li><code>Working directory</code>: Directory where all the data and model outputs are stored.</li>
<li><code>Country/state ISO code</code>: Country ISO 3166-1 alpha-3 code.</li>
<li><code>Projection EPSG code</code>: EPSG code of the coordinate reference system used for projecting maps.</li>
<li><code>Forest data source</code>: Source of the forest data. Could be either &ldquo;tmf&rdquo; or &ldquo;gfc&rdquo;.</li>
<li><code>Tree cover percentage</code>: Tree cover percentage used to define the forest when using GFC.</li>
<li><code>GDrive Rclone remote</code>: Name of the GoogleDrive remote in Rclone.</li>
<li><code>GDrive folder</code>: Name of the folder where GEE data will be exported.</li>
<li><code>WDPA API key</code>: Your WDPA API key.</li>
</ul>

<p>
Pushing the <code>Run</code> button in this box will download the data and compute the variables in the background. When the operation is finished, a forest cover change map appears in the list of QGIS layers. New folders are created in the working directory:
</p>

<ul class="org-ul">
<li><code>working_directory/iso_code</code>: Unique folder created for the study area.</li>
<li><code>working_directory/iso_code/data_raw</code>: Downloaded raw data for the study area.</li>
<li><code>working_directory/iso_code/data</code>: Processed data that will be used for modelling.</li>
<li><code>working_directory/iso_code/output</code>: Outputs (figures and tables).</li>
</ul>
</div>
</div>

<div id="outline-container-org1ef408c" class="outline-3">
<h3 id="org1ef408c">Sample observations</h3>
<div class="outline-text-3" id="text-org1ef408c">
<p>
This box is for collecting the information needed to sample the deforestation observations. This is a necessary step as we cannot fit a model using all forest pixels which are usually too many. Nonetheless, sampled observations must be representative of the deforestation process in the study area.
</p>

<ul class="org-ul">
<li><code>N# samples</code>: Number of observations to be sampled.</li>
<li><code>Adapt sampling</code>: If checked, the number of observations is proportional to forest area.</li>
<li><code>Random seed</code>: Random seed used to make the random sample reproducible.</li>
<li><code>Spatial cell size (km)</code>: Size of the spatial cells used to estimate spatial random effects. These spatial random effects account for the residual regional variability in the deforestation risk which is not taken into account by the spatial explanatory variables (e.g. distance to forest edge) included in the model.</li>
</ul>

<p>
Pushing the <code>Run</code> button in this box will sample the observations. Note that you cannot sample the observations before downloading and computing the variables (see previous step). When the operation is finished, the sampled observations appear in the list of QGIS layers. You can navigate on the map to confirm that about half the observations have been sampled in the deforested area and half in the non-deforested area. Files <code>sample.txt</code>, <code>sample_size.csv</code>, and <code>correlation.pdf</code> are added to the <code>outputs</code> folder. 
</p>
</div>
</div>

<div id="outline-container-org24a5313" class="outline-3">
<h3 id="org24a5313">Models FAR</h3>
<div class="outline-text-3" id="text-org24a5313">

<figure id="org92b20d2">
<img src="https://ecology.ghislainv.fr/forestatrisk-qgis-plugin/images/interface_models_far.png" alt="interface_models_far.png">

</figure>

<p>
This tab is for collecting the information needed to spatially model deforestation using three statistical models available in the <code>forestatrisk</code> (FAR) Python package: iCAR, GLM, and Random Forest models.
</p>

<ul class="org-ul">
<li><code>List of variables</code>: List of explanatory variables used for statistical modelling. Variable names must correspond to file names (without &ldquo;.tif&rdquo; extension) in folder <code>working_directory/iso_code/data</code>. Variable names must be separated by a comma.</li>
<li><code>Starting values for betas</code>: If -99 (recommended), starting values for betas correspond to estimates of a simple GLM with the same variables.</li>
<li><code>Prior Vrho</code>: If -1 (recommended), the prior for Vrho is an Inverse-Gamma.</li>
<li><code>MCMC</code>: Length of the MCMC for the final model.</li>
<li><code>Variable selection</code>: If checked (recommended), a variable selection is performed before fitting the final model.</li>
</ul>

<p>
Pushing the <code>Run</code> button in this tab will fit the statistical model to the deforestation observations. Note that you cannot fit the model if you have not sampled the observations (see previous step). Files <code>summary_icar.txt</code>, <code>mod_icar.pickle</code>, and <code>mcmc.pdf</code> are added to the <code>outputs</code> folder.
</p>
</div>
</div>

<div id="outline-container-orgfdd43c5" class="outline-3">
<h3 id="orgfdd43c5">Model MV</h3>
<div class="outline-text-3" id="text-orgfdd43c5">

<figure id="org72f67d8">
<img src="https://ecology.ghislainv.fr/forestatrisk-qgis-plugin/images/interface_model_mv.png" alt="interface_model_mv.png">

</figure>
</div>
</div>
</div>

<div id="outline-container-org2898185" class="outline-2">
<h2 id="org2898185">Contributing</h2>
<div class="outline-text-2" id="text-org2898185">
<p>
The <code>forestatrisk</code> QGIS plugin is Open Source and released under the <a href="license.html">GNU GPL version 3 license</a>. Anybody who is interested can contribute to the package development following our <a href="contributing.html">Community guidelines</a>. Every contributor must agree to follow the project&rsquo;s <a href="code_of_conduct.html">Code of conduct</a>.
</p>
</div>
</div>
</div>
</body>
</html>