#+title: forestatrisk QGIS plugin üì¶üêçüåé
#+author: Ghislain Vieilledent

#+options: title:t author:nil date:nil ^:{} toc:nil num:nil

#+link: GPLv3_link https://www.gnu.org/licenses/gpl-3.0.html
#+link: website_link https://ecology.ghislainv.fr/forestatrisk-qgis-plugin/%s
#+link: pypkg_link https://ecology.ghislainv.fr/forestatrisk

# #+macro: GPLv3 https://img.shields.io/badge/licence-GPLv3-8f10cb.svg
# #+macro: website https://img.shields.io/badge/web-FAR_QGIS_plugin-blue.svg
# #+macro: pypkg https://img.shields.io/badge/python-forestatrisk-306998?logo=python&logoColor=ffd43b&color=306998.svg
# This works for org but not for GitHub
# [[GPLv3_link][{{{GPLv3}}}]] [[website_link][{{{website}}}]] [[pypkg_link][{{{pypkg}}}]]

[[GPLv3_link][https://img.shields.io/badge/licence-GPLv3-8f10cb.svg]]
[[website_link][https://img.shields.io/badge/web-FAR_QGIS_plugin-blue.svg]]
[[pypkg_link][https://img.shields.io/badge/python-forestatrisk-306998?logo=python&logoColor=ffd43b&color=306998.svg]]

* Functionalities

The plugin can be used to map the deforestation risk for a country or area of interest. Four models can be used to derive the risk maps: iCAR, GLM, Random Forest, and Moving Window models. All models are calibrated using past deforestation observations for a given period of time between 2000 and 2022. Forest cover change maps are provided by the user or derived from two global tree/forest cover change products: [[https://earthenginepartners.appspot.com/science-2013-global-forest][Global Forest Change]] and [[https://forobs.jrc.ec.europa.eu/TMF][Tropical Moist Forests]].

* Installation

** System dependencies

[[https://www.qgis.org/en/site/][QGIS]] and [[https://gdal.org/index.html][GDAL]] must be installed on your system. The ~forestatrisk~ Python package must also be installed on your system before using the QGIS plugin.

*** Windows

**** Install QGIS and GDAL on Windows

To install QGIS and GDAL on Windows, use the [[https://trac.osgeo.org/osgeo4w/][OSGeo4W]] network installer. OSGeo4W is a binary distribution of a broad set of open source geospatial software for Windows environments (Windows 11 down to 7). Select /Express Install/ and install both QGIS and GDAL. Several Gb of space will be needed on disk to install these programs. This will also install /OSGeo4W Shell/ to execute command lines.

**** Install the ~forestatrisk~ Python package on Windows

To install the ~forestatrisk~ Python package, open OSGeo4W Shell, upgrade ~pip~ and ~setuptools~, and install ~forestatrisk~ with ~pip~.

#+begin_src shell
python3.exe -m pip install --upgrade pip setuptools
python3.exe -m pip install forestatrisk
#+end_src

Note: In case of problems, you can check the version of Python used by OSGeo4W using /OSGeo Shell/ and that the package wheels for ~forestatrisk~ are available on [[https://pypi.org/project/forestatrisk/#files][PyPI]] for your Windows and Python versions. Currently, PyPI provides wheels for Python 3.9 to 3.11 for Windows, Linux, and macOS 64-bit systems.

#+begin_src shell
python3.exe --version
#+end_src

*** Unix-like systems (Linux and macOS)

**** Install QGIS and GDAL on Unix-like systems

Install QGIS and GDAL on your system, for example using ~apt-get~ for Debian/Ubuntu Linux distributions.

#+begin_src shell
sudo apt-get update
sudo apt-get install qgis gdal-bin libgdal-dev
#+end_src

After installing GDAL, you can test the installation by running ~gdalinfo --version~ in the command prompt or terminal, which should display the installed GDAL version.

**** Install the ~forestatrisk~ Python package on Unix-like systems

On recent systems, you cannot use pip to install Python packages system-wide. As a consequence, we need to create a virtual environment and install the ~forestatrisk~ package in it. Make sure to also install the appropriate GDAL bindings using ~gdal==$(gdal-config --version)~. Once the package and its dependencies have been installed, you can deactivate the virtual environment.

#+begin_src shell
python3 -m venv /path/to/venv
source  /path/to/venv/bin/activate
python3 -m pip install forestatrisk gdal==$(gdal-config --version)
deactivate
#+end_src

Then, in the ~setup.py~ [[https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/intro.html#running-python-code-when-qgis-starts][Python file]], add the following two lines, adapting the path to your specific case (check the Python version). These two lines will be executed when QGIS starts and will add the path to the packages installed in the virtual environment to ~sys.path~.

#+begin_src python :results output :exports both
import sys
sys.path.append("/path/to/venv/lib/python3.11/site-packages/")
#+end_src

** Installing the ~forestatrisk~ plugin in QGIS

- Download the ~forestatrisk~ [[https://github.com/ghislainv/forestatrisk-qgis-plugin/archive/refs/heads/main.zip][zip file]] from GitHub.
- Open QGIS.
- In QGIS menu bar, go to ~Extensions/Install extensions/Install from ZIP~.
- Select the zip file that has been downloaded.

* Basic usage

** Plugin interface

[[website_link:images/interface_plugin.png]]

The plugin interface shows three tabs: ~Get variables~, ~Models FAR~, and ~Model MV~.

** Download and compute variables

** Sample observations

** Models FAR

** Model MV

* Contributing

The ~forestatrisk~ QGIS plugin is Open Source and released under the [[file:license.html][GNU GPL version 3 license]]. Anybody who is interested can contribute to the package development following our [[file:contributing.html][Community guidelines]]. Every contributor must agree to follow the project's [[file:code_of_conduct.html][Code of conduct]].
